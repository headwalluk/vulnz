<html lang='en'>
  <head>
    <meta charset='UTF-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
    <title>{{branding.heading}}</title>
  </head>
  <body>
    <h1>{{branding.heading}}</h1>
    <br />
    <p>{{branding.openingParagraph}}</p>

    <h2>üìä Executive Summary</h2>
    <table style='width: 100%; border-collapse: collapse; margin-bottom: 20px;'>
      <tr>
        <td style='padding: 8px; border: 1px solid #ddd;'><strong>Total Websites Monitored</strong></td>
        <td style='padding: 8px; border: 1px solid #ddd;'>{{executiveSummary.totalWebsites}}</td>
      </tr>
      <tr style='{{#if executiveSummary.vulnerableWebsites}}background-color: #fee;{{/if}}'>
        <td style='padding: 8px; border: 1px solid #ddd;'><strong>Vulnerable Websites</strong></td>
        <td style='padding: 8px; border: 1px solid #ddd; {{#if executiveSummary.vulnerableWebsites}}color: red; font-weight: bold;{{/if}}'>{{executiveSummary.vulnerableWebsites}}</td>
      </tr>
      <tr>
        <td style='padding: 8px; border: 1px solid #ddd;'><strong>Security Events (Past 7 Days)</strong></td>
        <td style='padding: 8px; border: 1px solid #ddd;'>{{executiveSummary.securityEvents}}</td>
      </tr>
      <tr style='{{#if executiveSummary.outdatedWordPress}}background-color: #fff3cd;{{/if}}'>
        <td style='padding: 8px; border: 1px solid #ddd;'><strong>Outdated WordPress</strong></td>
        <td style='padding: 8px; border: 1px solid #ddd;'>{{executiveSummary.outdatedWordPress}}</td>
      </tr>
      <tr style='{{#if executiveSummary.outdatedPhp}}background-color: #fff3cd;{{/if}}'>
        <td style='padding: 8px; border: 1px solid #ddd;'><strong>Outdated PHP</strong></td>
        <td style='padding: 8px; border: 1px solid #ddd;'>{{executiveSummary.outdatedPhp}}</td>
      </tr>
      <tr>
        <td style='padding: 8px; border: 1px solid #ddd;'><strong>Static Analysis Issues</strong></td>
        <td style='padding: 8px; border: 1px solid #ddd;'>{{executiveSummary.staticIssues}}</td>
      </tr>
      <tr>
        <td style='padding: 8px; border: 1px solid #ddd;'><strong>Component Changes (Past 7 Days)</strong></td>
        <td style='padding: 8px; border: 1px solid #ddd;'>{{executiveSummary.componentChanges}}</td>
      </tr>
      <tr style='{{#if executiveSummary.unmaintainedPlugins}}background-color: #fff3cd;{{/if}}'>
        <td style='padding: 8px; border: 1px solid #ddd;'><strong>Unmaintained Plugins</strong></td>
        <td style='padding: 8px; border: 1px solid #ddd;'>{{executiveSummary.unmaintainedPlugins}}</td>
      </tr>
      <tr>
        <td style='padding: 8px; border: 1px solid #ddd;'><strong>Newly Published Plugins</strong></td>
        <td style='padding: 8px; border: 1px solid #ddd;'>{{executiveSummary.newlyPublishedPlugins}}</td>
      </tr>
    </table>

    {{#if recommendedActions.length}}
      <h2>‚úÖ Recommended Actions</h2>
      <ol>
        {{#each recommendedActions}}
          <li style='margin-bottom: 8px; {{#if (eq this.priority "critical")}}color: red; font-weight: bold;{{else}}{{#if (eq this.priority "high")}}color: orange; font-weight: bold;{{else}}{{#if (eq this.priority "medium")}}color: #856404;{{/if}}{{/if}}{{/if}}'>
            {{this.action}}
          </li>
        {{/each}}
      </ol>
    {{/if}}

    <hr style='margin: 30px 0; border: none; border-top: 2px solid #ddd;' />

    {{#if vulnerableWebsites}}
      <h2>Potentially Vulnerable Websites</h2>
      <ul>
        {{#each vulnerableWebsites}}
          <li>
            <strong>{{{this.title}}}</strong><br />{{this.domain}}
            <ul>
              {{#each this.vulnerableComponents}}
                <li style='color: red;'>{{this}}</li>
              {{/each}}
            </ul>
          </li>
        {{/each}}
      </ul>
    {{else}}
      <p style='color: green; font-size:150%;'><strong>No vulnerable websites found üëç</strong></p>
    {{/if}}

    <h2>Security Events (Past 7 Days)</h2>
    {{#if securityEvents.summary.length}}
      <ul>
        {{#each securityEvents.summary}}
          <li>
            <strong>{{this.event_type}}</strong>:
            {{this.event_count}}
            events
            {{#if this.unique_ips}}({{this.unique_ips}} unique IPs){{/if}}
          </li>
        {{/each}}
      </ul>
      {{#if securityEvents.topCountries.length}}
        <p><strong>Top Attack Sources:</strong></p>
        <ul>
          {{#each securityEvents.topCountries}}
            <li>{{countryFlag this.country_code}} {{this.country_code}}: {{this.event_count}} events</li>
          {{/each}}
        </ul>
      {{/if}}
    {{else}}
      <p style='color: green;'><strong>No security events recorded</strong></p>
    {{/if}}

    <h2>Outdated Core Software</h2>
    {{#if outdatedSoftware.wordpress.length}}
      <h3>WordPress</h3>
      <ul>
        {{#each outdatedSoftware.wordpress}}
          <li><strong>{{{this.title}}}</strong> ({{this.domain}}) - Version {{this.version}}</li>
        {{/each}}
      </ul>
    {{/if}}
    {{#if outdatedSoftware.php.length}}
      <h3>PHP</h3>
      <ul>
        {{#each outdatedSoftware.php}}
          <li><strong>{{{this.title}}}</strong> ({{this.domain}}) - Version {{this.version}}</li>
        {{/each}}
      </ul>
    {{/if}}
    {{#unless outdatedSoftware.wordpress.length}}
      {{#unless outdatedSoftware.php.length}}
        <p style='color: green;'><strong>Core software is up to date</strong></p>
      {{/unless}}
    {{/unless}}

    <h2>Static Analysis Issues</h2>
    {{#if staticAnalysis.summary.length}}
      <p><strong>Issues by website:</strong></p>
      <ul>
        {{#each staticAnalysis.summary}}
          <li>
            <strong>{{{this.title}}}</strong>
            ({{this.domain}}) -
            {{this.total_issues}}
            issues ({{this.critical_count}}
            critical,
            {{this.high_count}}
            high)
          </li>
        {{/each}}
      </ul>
      {{#if staticAnalysis.topFiles.length}}
        <p><strong>Most problematic files:</strong></p>
        <ul>
          {{#each staticAnalysis.topFiles}}
            <li>{{this.domain}}: {{this.filePath}} - {{this.issueCount}} issues</li>
          {{/each}}
        </ul>
      {{/if}}
    {{else}}
      <p style='color: green;'><strong>No static analysis issues found</strong></p>
    {{/if}}

    <h2>Component Changes (Past 7 Days)</h2>
    {{#if componentChanges.length}}
      <ul>
        {{#each componentChanges}}
          <li>
            <strong style='text-transform: uppercase;'>{{this.change_type}}</strong>
            {{#if this.website_title}}
              on
              <em>{{{this.website_title}}}</em>
              ({{this.domain}})
            {{else}}
              on
              <em>{{this.domain}}</em>
            {{/if}}
            <br />
            {{this.component_title}}
            {{#if this.new_version}}
              {{#if this.old_version}}
                -
                {{this.old_version}}
                ‚Üí
                {{this.new_version}}
              {{else}}
                - Version
                {{this.new_version}}
              {{/if}}
            {{else}}
              - Version
              {{this.old_version}}
            {{/if}}
            <br />
            <small>{{this.changed_at}}</small>
          </li>
        {{/each}}
      </ul>
    {{else}}
      <p><strong>No component changes</strong></p>
    {{/if}}

    <h2>Plugins to Keep an Eye On</h2>
    {{#if pluginsToMonitor.unmaintained.length}}
      <h3>‚ö†Ô∏è Unmaintained Plugins</h3>
      <p>These plugins have not been updated in over {{pluginsToMonitor.unmaintainedThresholdMonths}} months and may be abandoned:</p>
      <ul>
        {{#each pluginsToMonitor.unmaintained}}
          <li>
            <strong>{{this.title}}</strong>
            <br />
            <small style='color: #666;'>Last updated: {{this.lastUpdated}}</small>
            <br />
            <small style='color: #888;'>Found on {{this.websites.length}} website{{#if (gt this.websites.length 1)}}s{{/if}}:
              {{#each this.websites}}
                {{#if this.websiteTitle}}{{{this.websiteTitle}}}{{else}}{{this.domain}}{{/if}}{{#unless @last}}, {{/unless}}
              {{/each}}
            </small>
          </li>
        {{/each}}
      </ul>
    {{/if}}
    {{#if pluginsToMonitor.newlyPublished.length}}
      <h3>üÜï Newly Published Plugins</h3>
      <p>These plugins were published within the last {{pluginsToMonitor.newlyPublishedThresholdMonths}} months and may not have undergone extensive security testing:</p>
      <ul>
        {{#each pluginsToMonitor.newlyPublished}}
          <li>
            <strong>{{this.title}}</strong>
            <br />
            <small style='color: #666;'>Published: {{this.added}}</small>
            <br />
            <small style='color: #888;'>Found on {{this.websites.length}} website{{#if (gt this.websites.length 1)}}s{{/if}}:
              {{#each this.websites}}
                {{#if this.websiteTitle}}{{{this.websiteTitle}}}{{else}}{{this.domain}}{{/if}}{{#unless @last}}, {{/unless}}
              {{/each}}
            </small>
          </li>
        {{/each}}
      </ul>
    {{/if}}
    {{#unless pluginsToMonitor.unmaintained.length}}
      {{#unless pluginsToMonitor.newlyPublished.length}}
        <p style='color: green;'><strong>All plugins are actively maintained and well-established üëç</strong></p>
      {{/unless}}
    {{/unless}}

    <p>{{branding.closingParagraph}}</p>

    <p>{{branding.signOff}}</p>

    <p>{{branding.postScript}}</p>

  </body>
</html>