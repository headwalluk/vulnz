<html lang='en'>
  <head>
    <meta charset='UTF-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
    <title>{{branding.heading}}</title>
  </head>
  <body>
    <h1>{{branding.heading}}</h1>
    <br />
    <p>{{branding.openingParagraph}}</p>
    <p style='padding-left:2rem;'>
      Monitored websites:
      <strong>{{totalWebsites}}</strong><br />
      Vulnerable websites:
      <strong style='color:red; font-weight:bold;'>{{vulnerableWebsitesCount}}</strong><br />
      <em><small>Websites with one or more known vulnerabilities</small></em></p>
    {{#if vulnerableWebsites}}
      <h2>Potentially Vulnerable Websites</h2>
      <ul>
        {{#each vulnerableWebsites}}
          <li>
            <strong>{{{this.title}}}</strong><br />{{this.domain}}
            <ul>
              {{#each this.vulnerableComponents}}
                <li style='color: red;'>{{this}}</li>
              {{/each}}
            </ul>
          </li>
        {{/each}}
      </ul>
    {{else}}
      <p style='color: green; font-size:150%;'><strong>No vulnerable websites found üëç</strong></p>
    {{/if}}

    <h2>Security Events (Past 7 Days)</h2>
    {{#if securityEvents.summary.length}}
      <ul>
        {{#each securityEvents.summary}}
          <li>
            <strong>{{this.event_type}}</strong>: {{this.event_count}} events
            {{#if this.unique_ips}}({{this.unique_ips}} unique IPs){{/if}}
          </li>
        {{/each}}
      </ul>
      {{#if securityEvents.topCountries.length}}
        <p><strong>Top Attack Sources:</strong></p>
        <ul>
          {{#each securityEvents.topCountries}}
            <li>{{this.country_code}}: {{this.event_count}} events</li>
          {{/each}}
        </ul>
      {{/if}}
    {{else}}
      <p style='color: green;'><strong>No security events recorded</strong></p>
    {{/if}}

    <h2>Outdated Software</h2>
    {{#if outdatedSoftware.wordpress.length}}
      <h3>WordPress</h3>
      <ul>
        {{#each outdatedSoftware.wordpress}}
          <li><strong>{{{this.title}}}</strong> ({{this.domain}}) - Version {{this.version}}</li>
        {{/each}}
      </ul>
    {{/if}}
    {{#if outdatedSoftware.php.length}}
      <h3>PHP</h3>
      <ul>
        {{#each outdatedSoftware.php}}
          <li><strong>{{{this.title}}}</strong> ({{this.domain}}) - Version {{this.version}}</li>
        {{/each}}
      </ul>
    {{/if}}
    {{#unless outdatedSoftware.wordpress.length}}
      {{#unless outdatedSoftware.php.length}}
        <p style='color: green;'><strong>All software is up to date</strong></p>
      {{/unless}}
    {{/unless}}

    <h2>Static Analysis Issues</h2>
    {{#if staticAnalysis.summary.length}}
      <p><strong>Issues by website:</strong></p>
      <ul>
        {{#each staticAnalysis.summary}}
          <li>
            <strong>{{{this.title}}}</strong> ({{this.domain}}) - {{this.total_issues}} issues
            ({{this.critical_count}} critical, {{this.high_count}} high)
          </li>
        {{/each}}
      </ul>
      {{#if staticAnalysis.topFiles.length}}
        <p><strong>Most problematic files:</strong></p>
        <ul>
          {{#each staticAnalysis.topFiles}}
            <li>{{this.domain}}: {{this.filePath}} - {{this.issueCount}} issues</li>
          {{/each}}
        </ul>
      {{/if}}
    {{else}}
      <p style='color: green;'><strong>No static analysis issues found</strong></p>
    {{/if}}

    <h2>Component Changes (Past 7 Days)</h2>
    {{#if componentChanges.length}}
      <ul>
        {{#each componentChanges}}
          <li>
            <strong>{{this.change_type}}</strong>: {{this.change_count}} changes
          </li>
        {{/each}}
      </ul>
    {{else}}
      <p><strong>No component changes</strong></p>
    {{/if}}

    <p>{{branding.closingParagraph}}</p>

    <p>{{branding.signOff}}</p>

    <p>{{branding.postScript}}</p>

  </body>
</html>